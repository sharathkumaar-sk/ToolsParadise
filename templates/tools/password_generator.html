{% extends "base.html" %}
{% block content %}

<style>
  .rotate-once {
    animation: rotate180 0.5s ease-in-out;
  }
  @keyframes rotate180 {
    from { transform: rotate(0deg); }
    to { transform: rotate(180deg); }
  }
</style>

<!-- Page Header -->
<div class="mb-10 text-center">
  <h1 class="text-2xl md:text-3xl font-semibold text-[var(--accent)] mb-2">
    Password Generator
  </h1>
  <p class="text-gray-400 text-sm max-w-md mx-auto">
    Generate strong, secure passwords instantly
  </p>
</div>

<!-- Overall Container -->
  <div class="flex gap-6 flex-col lg:flex-row justify-center mx-auto max-w-6xl bg-[var(--bg-sidebar)] p-4 rounded-2xl">

  <!-- Main Tool Card -->
  <div class="w-full lg:w-[520px]
              bg-[var(--card-bg)]
              border border-[var(--border-soft)]
              rounded-2xl
              p-6 md:p-8
              shadow-xl">

    <!-- Generated Password -->
    <div class="mb-6">
    <label class="text-sm text-gray-400 block mb-2">
        Generated Password
    </label>

    <div class="flex items-center gap-2
                bg-[var(--input-bg)]
                border border-[var(--border-soft)]
                rounded-lg px-3 py-2
                ring-1 ring-transparent
                focus-within:ring-[var(--accent-soft)]">

        <input
        id="passwordOutput"
        readonly
        placeholder="Click generate to create a password"
        class="bg-[var(--input-bg)]
                flex-1 text-sm
                text-gray-200
                placeholder:text-gray-500
                font-mono tracking-wide
                outline-none disabled">

        <button type="button"
                onclick="copyPassword()"
                title="Copy to clipboard">
        <i data-lucide="copy" id="copyIcon"
            class="w-4 h-4 text-gray-500
                    hover:text-[var(--accent)]
                    transition"></i>
        </button>
    </div>
    </div>


    <!-- Length -->
    <div class="mb-6">
      <div class="flex justify-between text-sm mb-1">
        <span>Password Length</span>
        <span id="lengthValue"
              class="text-[var(--accent)] font-medium">
          16
        </span>
      </div>

      <input type="range"
             min="6"
             max="64"
             value="16"
             id="lengthSlider"
             class="w-full accent-[var(--accent)]">
    </div>

    <!-- Options -->
    <div class="space-y-3 text-sm mb-6">
      <label class="flex items-center gap-2">
        <input type="checkbox" id="upper" checked
               class="accent-[var(--accent)]">
        Uppercase Letters (A–Z)
      </label>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="lower" checked
               class="accent-[var(--accent)]">
        Lowercase Letters (a–z)
      </label>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="digits" checked
               class="accent-[var(--accent)]">
        Numbers (0–9)
      </label>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="symbols"
               class="accent-[var(--accent)]">
        Symbols (!@#$%^&*)
      </label>
    </div>

    <!-- Generate Button -->
    <button type="button"
            onclick="generatePassword()"
            class="w-full flex items-center justify-center gap-2
                   bg-[var(--accent)]
                   hover:bg-[#38b2ac]
                   text-[#022c2c]
                   font-medium
                   py-2.5
                   rounded-xl
                   transition">
      <i data-lucide="refresh-cw" id="refreshIcon" class="w-4 h-4"></i>
      Generate Password
    </button>

  </div>

  <!-- Tips Card -->
  <div class="w-full lg:w-80
              bg-[var(--card-bg)]
              border border-[var(--border-soft)]
              rounded-2xl
              p-6
              shadow-xl">

    <h3 class="text-lg font-semibold text-[var(--accent)] mb-4">
      Password Tips & Facts
    </h3>

    <ul class="space-y-3 text-sm text-gray-300">
      <li class="flex items-start gap-2">
        <span class="text-[var(--accent)] mt-0.5">•</span>
        Use at least 12 characters for better security
      </li>
      <li class="flex items-start gap-2">
        <span class="text-[var(--accent)] mt-0.5">•</span>
        Include a mix of uppercase, lowercase, numbers, and symbols
      </li>
      <li class="flex items-start gap-2">
        <span class="text-[var(--accent)] mt-0.5">•</span>
        Avoid common words, names, or predictable patterns
      </li>
      <li class="flex items-start gap-2">
        <span class="text-[var(--accent)] mt-0.5">•</span>
        Use unique passwords for each account
      </li>
      <li class="flex items-start gap-2">
        <span class="text-[var(--accent)] mt-0.5">•</span>
        Consider using a password manager
      </li>
    </ul>

    <div class="mt-6 p-3 bg-[var(--accent-soft)] rounded-lg">
      <p class="text-xs text-gray-300">
        <strong>Fun Fact:</strong> A 12-character password with mixed characters has over 95 quadrillion possible combinations!
      </p>
    </div>

  </div>

</div>

<script>
  const slider = document.getElementById("lengthSlider");
  const lengthValue = document.getElementById("lengthValue");
  const output = document.getElementById("passwordOutput");

  slider.addEventListener("input", () => {
    lengthValue.textContent = slider.value;
  });

  async function generatePassword() {
    const refreshIcon = document.getElementById("refreshIcon");
    refreshIcon.classList.add("rotate-once");

    setTimeout(() => {
      refreshIcon.classList.remove("rotate-once");
    }, 500);

    try {
      const res = await fetch("/api/password-generator", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          length: slider.value,
          upper: document.getElementById("upper").checked,
          lower: document.getElementById("lower").checked,
          digits: document.getElementById("digits").checked,
          symbols: document.getElementById("symbols").checked
        })
      });

      const data = await res.json();
      output.placeholder = data.password || "Select at least one option";
      output.value = "";
    } catch (err) {
      console.error("Error generating password:", err);
    }
  }

  async function copyPassword() {
    const output = document.getElementById("passwordOutput");
    if (!output.placeholder || output.placeholder === "Click generate to create a password") {
      return;
    }
    const textToCopy = output.placeholder;
    try {
      await navigator.clipboard.writeText(textToCopy);
    } catch (err) {
      fallbackCopyTextToClipboard(textToCopy);
    }
    showCopyFeedback();
  }

  function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.left = "-999999px";
    textArea.style.top = "-999999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
      document.execCommand('copy');
    } catch (err) {
      console.error('Fallback: Oops, unable to copy', err);
    }
    document.body.removeChild(textArea);
  }

  function showCopyFeedback() {
    const copyIcon = document.getElementById("copyIcon");
    copyIcon.setAttribute("data-lucide", "check");
    lucide.createIcons();
    setTimeout(() => {
      const svg = document.getElementById("copyIcon");
      svg.outerHTML = '<i data-lucide="copy" id="copyIcon" class="w-4 h-4 text-gray-500 hover:text-[var(--accent)] transition"></i>';
      lucide.createIcons();
    }, 1000);
  }
  lucide.createIcons();

</script>

{% endblock %}